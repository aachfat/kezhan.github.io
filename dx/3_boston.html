<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Prédiction de la valeur immobilière</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="site_libs/highlight/textmate.css"
      type="text/css" />
<script src="site_libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: -22px; }
.code-folding-btn.collapsed { margin-bottom: 4px; }
</style>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.9em;
  padding-left: 5px;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Accueil
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-pencil"></span>
     
    Bases de R
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="0_cours_rapide_R.html">
        <span class="fa fa-anchor"></span>
         
        Bases de R
      </a>
    </li>
    <li>
      <a href="0_manipulation.html">
        <span class="fa fa-table"></span>
         
        Manipulation des données
      </a>
    </li>
    <li>
      <a href="0_exploration.html">
        <span class="fa fa-binoculars"></span>
         
        Exploration des données
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-pencil"></span>
     
    Data Visualisation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="1_base.html">
        <span class="fa fa-bar-chart"></span>
         
        Graphiques de base
      </a>
    </li>
    <li>
      <a href="1_avance.html">
        <span class="fa fa-cogs"></span>
         
        Graphiques avancés
      </a>
    </li>
    <li>
      <a href="2_non_technique.html">
        <span class="fa fa-industry"></span>
         
        Exemples non techniques
      </a>
    </li>
    <li>
      <a href="2_technique.html">
        <span class="fa fa-flask"></span>
         
        Notions techniques
      </a>
    </li>
    <li>
      <a href="3_geo.html">
        <span class="fa fa-map"></span>
         
        Données géographiques
      </a>
    </li>
    <li>
      <a href="4_machine_learning.html">
        <span class="fa fa-rocket"></span>
         
        Machine learning
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-info"></span>
     
    Contact
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://fr.linkedin.com/in/kezhanshi">
        <span class="fa fa-linkedin-square"></span>
         
        Linkedin
      </a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Prédiction de la valeur immobilière</h1>

</div>


<div id="objectif" class="section level1">
<h1><span class="header-section-number">1</span> Objectif</h1>
<ul>
<li>Etudier les données démographiques</li>
<li>Prédiction des valeurs immobilières en fonction des caractéristiques démographiques</li>
</ul>
<pre class="r"><code>install.packages(&quot;neuralnet&quot;)</code></pre>
</div>
<div id="donnees" class="section level1">
<h1><span class="header-section-number">2</span> Données</h1>
<div id="exploration-des-donnees" class="section level2">
<h2><span class="header-section-number">2.1</span> Exploration des données</h2>
<pre class="r"><code>library(MASS)
library(neuralnet)
library(corrplot)
data=Boston
head(Boston)</code></pre>
<pre><code>##      crim zn indus chas   nox    rm  age    dis rad tax ptratio  black
## 1 0.00632 18  2.31    0 0.538 6.575 65.2 4.0900   1 296    15.3 396.90
## 2 0.02731  0  7.07    0 0.469 6.421 78.9 4.9671   2 242    17.8 396.90
## 3 0.02729  0  7.07    0 0.469 7.185 61.1 4.9671   2 242    17.8 392.83
## 4 0.03237  0  2.18    0 0.458 6.998 45.8 6.0622   3 222    18.7 394.63
## 5 0.06905  0  2.18    0 0.458 7.147 54.2 6.0622   3 222    18.7 396.90
## 6 0.02985  0  2.18    0 0.458 6.430 58.7 6.0622   3 222    18.7 394.12
##   lstat medv
## 1  4.98 24.0
## 2  9.14 21.6
## 3  4.03 34.7
## 4  2.94 33.4
## 5  5.33 36.2
## 6  5.21 28.7</code></pre>
<pre class="r"><code>hist(data$age)</code></pre>
<p><img src="3_boston_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>hist(data$tax)</code></pre>
<p><img src="3_boston_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code>hist(data$crim)</code></pre>
<p><img src="3_boston_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="correlation" class="section level2">
<h2><span class="header-section-number">2.2</span> Corrélation</h2>
<pre class="r"><code>M=cor(data)
corrplot(M)</code></pre>
<p><img src="3_boston_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
</div>
<div id="prediction" class="section level1">
<h1><span class="header-section-number">3</span> Prédiction</h1>
<div id="creation-bases" class="section level2">
<h2><span class="header-section-number">3.1</span> Création bases</h2>
<pre class="r"><code>library(caret)</code></pre>
<pre><code>## Loading required package: lattice</code></pre>
<pre><code>## Loading required package: ggplot2</code></pre>
<pre class="r"><code>ind=createDataPartition(Boston$medv, times = 1,p = 0.3,list=FALSE)
train=data[ind,]
test=data[-ind,]
dim(train);dim(test)</code></pre>
<pre><code>## [1] 154  14</code></pre>
<pre><code>## [1] 352  14</code></pre>
</div>
<div id="glm" class="section level2">
<h2><span class="header-section-number">3.2</span> GLM</h2>
<pre class="r"><code>lm.fit &lt;- glm(medv~., data=train)
summary(lm.fit)</code></pre>
<pre><code>## 
## Call:
## glm(formula = medv ~ ., data = train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -9.3933  -2.3257  -0.5386   1.9159  19.2650  
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  2.114e+01  8.002e+00   2.642  0.00917 ** 
## crim         7.493e-03  6.893e-02   0.109  0.91360    
## zn          -3.371e-04  2.065e-02  -0.016  0.98700    
## indus        7.569e-03  9.720e-02   0.078  0.93804    
## chas         1.269e-01  1.344e+00   0.094  0.92490    
## nox         -1.421e+01  5.790e+00  -2.454  0.01537 *  
## rm           5.997e+00  6.462e-01   9.280 2.87e-16 ***
## age         -1.266e-02  2.081e-02  -0.608  0.54402    
## dis         -7.913e-01  3.179e-01  -2.489  0.01396 *  
## rad          2.093e-01  1.101e-01   1.901  0.05935 .  
## tax         -1.363e-02  5.985e-03  -2.278  0.02427 *  
## ptratio     -1.155e+00  2.209e-01  -5.231 6.03e-07 ***
## black        8.918e-03  4.417e-03   2.019  0.04541 *  
## lstat       -2.300e-01  7.915e-02  -2.905  0.00426 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 15.19712)
## 
##     Null deviance: 12104.8  on 153  degrees of freedom
## Residual deviance:  2127.6  on 140  degrees of freedom
## AIC: 871.41
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<pre class="r"><code>pr.lm &lt;- predict(lm.fit,test)
MSE.lm &lt;- sum((pr.lm - test$medv)^2)/nrow(test)</code></pre>
</div>
<div id="reseaux-de-neurones" class="section level2">
<h2><span class="header-section-number">3.3</span> Réseaux de neurones</h2>
<pre class="r"><code>maxs &lt;- apply(data, 2, max) 
mins &lt;- apply(data, 2, min)

scaled &lt;- as.data.frame(scale(data, center = mins, scale = maxs - mins))
scale(c(1,2,3,4),center=1,scale=3)</code></pre>
<pre><code>##           [,1]
## [1,] 0.0000000
## [2,] 0.3333333
## [3,] 0.6666667
## [4,] 1.0000000
## attr(,&quot;scaled:center&quot;)
## [1] 1
## attr(,&quot;scaled:scale&quot;)
## [1] 3</code></pre>
<pre class="r"><code>head(data)</code></pre>
<pre><code>##      crim zn indus chas   nox    rm  age    dis rad tax ptratio  black
## 1 0.00632 18  2.31    0 0.538 6.575 65.2 4.0900   1 296    15.3 396.90
## 2 0.02731  0  7.07    0 0.469 6.421 78.9 4.9671   2 242    17.8 396.90
## 3 0.02729  0  7.07    0 0.469 7.185 61.1 4.9671   2 242    17.8 392.83
## 4 0.03237  0  2.18    0 0.458 6.998 45.8 6.0622   3 222    18.7 394.63
## 5 0.06905  0  2.18    0 0.458 7.147 54.2 6.0622   3 222    18.7 396.90
## 6 0.02985  0  2.18    0 0.458 6.430 58.7 6.0622   3 222    18.7 394.12
##   lstat medv
## 1  4.98 24.0
## 2  9.14 21.6
## 3  4.03 34.7
## 4  2.94 33.4
## 5  5.33 36.2
## 6  5.21 28.7</code></pre>
<pre class="r"><code>head(scaled)</code></pre>
<pre><code>##           crim   zn      indus chas       nox        rm       age
## 1 0.0000000000 0.18 0.06781525    0 0.3148148 0.5775053 0.6416066
## 2 0.0002359225 0.00 0.24230205    0 0.1728395 0.5479977 0.7826982
## 3 0.0002356977 0.00 0.24230205    0 0.1728395 0.6943859 0.5993821
## 4 0.0002927957 0.00 0.06304985    0 0.1502058 0.6585553 0.4418126
## 5 0.0007050701 0.00 0.06304985    0 0.1502058 0.6871048 0.5283213
## 6 0.0002644715 0.00 0.06304985    0 0.1502058 0.5497222 0.5746653
##         dis        rad        tax   ptratio     black      lstat      medv
## 1 0.2692031 0.00000000 0.20801527 0.2872340 1.0000000 0.08967991 0.4222222
## 2 0.3489620 0.04347826 0.10496183 0.5531915 1.0000000 0.20447020 0.3688889
## 3 0.3489620 0.04347826 0.10496183 0.5531915 0.9897373 0.06346578 0.6600000
## 4 0.4485446 0.08695652 0.06679389 0.6489362 0.9942761 0.03338852 0.6311111
## 5 0.4485446 0.08695652 0.06679389 0.6489362 1.0000000 0.09933775 0.6933333
## 6 0.4485446 0.08695652 0.06679389 0.6489362 0.9929901 0.09602649 0.5266667</code></pre>
<pre class="r"><code>train_ &lt;- scaled[ind,]
test_ &lt;- scaled[-ind,]</code></pre>
<pre class="r"><code>n &lt;- names(train_)
f &lt;- as.formula(paste(&quot;medv ~&quot;, paste(n[!n %in% &quot;medv&quot;], collapse = &quot; + &quot;)))
nn &lt;- neuralnet(f,data=train_,hidden=c(5,3),linear.output=T)</code></pre>
<p><strong>Viualisation des réseaux de neurones</strong></p>
<pre class="r"><code>plot(nn)</code></pre>
<p><strong>Prédiction - réseaux de neurones</strong></p>
<pre class="r"><code>pr.nn &lt;- compute(nn,test_[,1:13])

pr.nn_ &lt;- pr.nn$net.result*(max(data$medv)-min(data$medv))+min(data$medv)
test.r &lt;- (test_$medv)*(max(data$medv)-min(data$medv))+min(data$medv)
test$medv</code></pre>
<pre><code>##   [1] 21.6 36.2 28.7 22.9 16.5 18.9 15.0 18.9 21.7 18.2 19.9 20.2 18.2 13.6
##  [15] 19.6 14.5 13.9 14.8 21.0 12.7 13.1 20.0 21.0 34.9 24.7 21.2 20.0 16.6
##  [29] 14.4 19.7 20.5 25.0 23.4 18.9 35.4 24.7 31.6 18.7 16.0 22.2 25.0 24.2
##  [43] 21.7 23.4 24.1 20.8 21.2 20.3 28.0 23.9 24.8 22.9 26.6 22.2 23.6 22.6
##  [57] 22.0 22.9 25.0 20.6 28.4 26.5 18.6 20.1 19.5 19.5 19.4 21.7 22.8 18.8
##  [71] 18.7 18.5 18.3 21.2 19.2 20.4 22.0 20.3 18.8 21.4 18.0 19.2 19.6 23.0
##  [85] 17.4 17.1 13.3 14.0 14.4 13.4 15.6 13.8 15.6 15.4 21.5 19.6 19.4 15.6
##  [99] 13.1 41.3 24.3 27.0 50.0 50.0 50.0 22.7 25.0 50.0 23.8 22.3 19.1 23.1
## [113] 23.6 22.6 29.4 24.6 37.2 39.8 36.2 37.9 32.5 26.4 29.6 50.0 29.8 37.0
## [127] 30.5 31.1 50.0 30.3 34.6 34.9 24.1 42.3 50.0 22.6 24.4 19.3 28.1 23.7
## [141] 23.3 28.7 21.5 23.0 26.7 30.1 50.0 37.6 31.6 24.3 41.7 29.0 24.0 25.1
## [155] 31.5 23.3 22.0 20.1 22.2 23.7 17.6 18.5 26.2 24.8 29.6 21.9 44.0 50.0
## [169] 36.0 30.1 31.0 36.5 22.8 30.7 43.5 21.1 25.2 24.4 35.2 32.4 32.0 33.2
## [183] 33.1 29.1 45.4 35.4 46.0 50.0 22.0 20.1 23.2 22.3 24.8 37.3 27.9 21.7
## [197] 28.6 27.1 20.3 22.5 29.0 24.8 22.0 33.1 36.1 33.4 28.2 16.1 22.1 19.4
## [211] 16.2 19.8 21.0 23.1 20.4 25.0 24.6 23.0 19.3 19.8 17.1 20.7 21.1 19.5
## [225] 18.5 20.6 18.7 32.7 16.5 23.9 31.2 17.5 17.2 23.1 22.9 24.1 18.6 30.1
## [239] 18.2 20.6 17.8 22.7 22.6 25.0 19.9 20.8 16.8 21.9 27.5 21.9 50.0 50.0
## [253] 50.0 50.0 50.0 13.8 15.0 13.3 13.1 10.4 10.9 11.3 12.3  8.8  7.2 10.2
## [267] 11.5 23.2 13.8 13.1 12.5  8.5  5.0  7.2 12.1  8.3  8.5  5.0 11.9 27.9
## [281] 27.5 17.2 17.9 16.3  7.2  7.5 10.4  8.8  8.4 11.7  8.3 10.9 11.0  9.5
## [295] 14.5 14.1 16.1 11.7 13.4  8.7  8.4 12.8 17.1 15.4 14.9 12.6 14.1 13.0
## [309] 13.4 15.2 17.8 14.1 12.7 13.5 14.9 20.0 16.4 20.2 21.4 19.0 19.1 19.1
## [323] 20.1 19.6 23.2 13.8 13.3 12.0 14.6 23.0 23.7 21.8 20.6 21.2 19.1 20.6
## [337] 15.2  7.0 13.6 20.1 21.8 24.5 23.1 19.7 18.3 21.2 16.8 22.4 20.6 23.9
## [351] 22.0 11.9</code></pre>
<pre class="r"><code>MSE.nn &lt;- sum((test$medv - pr.nn_)^2)/nrow(test_)
MSE.nn</code></pre>
<pre><code>## [1] 23.77730652</code></pre>
<pre class="r"><code>MSE.lm</code></pre>
<pre><code>## [1] 31.06111235</code></pre>
</div>
<div id="arbre-de-regression" class="section level2">
<h2><span class="header-section-number">3.4</span> Arbre de régression</h2>
<pre class="r"><code>library(rpart)
rt.fit &lt;- rpart(medv~., data=train)
summary(rt.fit)</code></pre>
<pre><code>## Call:
## rpart(formula = medv ~ ., data = train)
##   n= 154 
## 
##              CP nsplit     rel error       xerror          xstd
## 1 0.59529153910      0 1.00000000000 1.0133947081 0.14688930387
## 2 0.12259267492      1 0.40470846090 0.4610164868 0.04884130992
## 3 0.10671584575      2 0.28211578597 0.4066714530 0.04431206257
## 4 0.04126273789      3 0.17539994023 0.2633694311 0.02921147502
## 5 0.02238094129      4 0.13413720234 0.2056946078 0.02404280065
## 6 0.01804807355      5 0.11175626105 0.2173605993 0.02774167499
## 7 0.01000000000      6 0.09370818749 0.2113698661 0.02730031311
## 
## Variable importance
##      rm   lstat   indus    crim ptratio     age     dis     nox     tax 
##      35      17      12       6       6       6       5       5       4 
##      zn   black     rad 
##       3       2       1 
## 
## Node number 1: 154 observations,    complexity param=0.5952915391
##   mean=22.36298701, MSE=78.60272095 
##   left son=2 (124 obs) right son=3 (30 obs)
##   Primary splits:
##       rm      &lt; 6.776    to the left,  improve=0.5952915391, (0 missing)
##       lstat   &lt; 8.075    to the right, improve=0.4770233708, (0 missing)
##       indus   &lt; 7.225    to the right, improve=0.4121399928, (0 missing)
##       crim    &lt; 0.62666  to the right, improve=0.3218826685, (0 missing)
##       ptratio &lt; 19.9     to the right, improve=0.3173477653, (0 missing)
##   Surrogate splits:
##       lstat   &lt; 4.265    to the right, agree=0.877, adj=0.367, (0 split)
##       indus   &lt; 4.01     to the right, agree=0.864, adj=0.300, (0 split)
##       ptratio &lt; 13.85    to the right, agree=0.838, adj=0.167, (0 split)
##       crim    &lt; 0.03529  to the right, agree=0.825, adj=0.100, (0 split)
##       zn      &lt; 37.5     to the left,  agree=0.825, adj=0.100, (0 split)
## 
## Node number 2: 124 observations,    complexity param=0.1225926749
##   mean=18.9983871, MSE=26.71031998 
##   left son=4 (55 obs) right son=5 (69 obs)
##   Primary splits:
##       lstat &lt; 14.665   to the right, improve=0.4480454241, (0 missing)
##       dis   &lt; 2.4129   to the left,  improve=0.4264377266, (0 missing)
##       crim  &lt; 0.650835 to the right, improve=0.4076336243, (0 missing)
##       nox   &lt; 0.5805   to the right, improve=0.4052679050, (0 missing)
##       indus &lt; 16.01    to the right, improve=0.3956626610, (0 missing)
##   Surrogate splits:
##       age   &lt; 88.95    to the right, agree=0.839, adj=0.636, (0 split)
##       dis   &lt; 2.4129   to the left,  agree=0.806, adj=0.564, (0 split)
##       nox   &lt; 0.5635   to the right, agree=0.790, adj=0.527, (0 split)
##       indus &lt; 16.01    to the right, agree=0.782, adj=0.509, (0 split)
##       tax   &lt; 434.5    to the right, agree=0.758, adj=0.455, (0 split)
## 
## Node number 3: 30 observations,    complexity param=0.1067158457
##   mean=36.27, MSE=52.89476667 
##   left son=6 (20 obs) right son=7 (10 obs)
##   Primary splits:
##       rm      &lt; 7.468    to the left,  improve=0.8140540684, (0 missing)
##       black   &lt; 389.11   to the right, improve=0.2467821878, (0 missing)
##       ptratio &lt; 15.05    to the right, improve=0.1759574911, (0 missing)
##       lstat   &lt; 4.33     to the right, improve=0.1745705502, (0 missing)
##       crim    &lt; 0.08031  to the left,  improve=0.1702391598, (0 missing)
##   Surrogate splits:
##       black   &lt; 389.11   to the right, agree=0.767, adj=0.3, (0 split)
##       crim    &lt; 0.103735 to the left,  agree=0.733, adj=0.2, (0 split)
##       age     &lt; 78       to the left,  agree=0.733, adj=0.2, (0 split)
##       dis     &lt; 2.47725  to the right, agree=0.733, adj=0.2, (0 split)
##       ptratio &lt; 14.8     to the right, agree=0.733, adj=0.2, (0 split)
## 
## Node number 4: 55 observations,    complexity param=0.04126273789
##   mean=15.12363636, MSE=19.51380496 
##   left son=8 (16 obs) right son=9 (39 obs)
##   Primary splits:
##       crim    &lt; 9.71509  to the right, improve=0.4653842621, (0 missing)
##       dis     &lt; 2.0037   to the left,  improve=0.3801202179, (0 missing)
##       nox     &lt; 0.531    to the right, improve=0.3652160709, (0 missing)
##       tax     &lt; 551.5    to the right, improve=0.3645830907, (0 missing)
##       ptratio &lt; 19.65    to the right, improve=0.3241115095, (0 missing)
##   Surrogate splits:
##       rad &lt; 16       to the right, agree=0.818, adj=0.375, (0 split)
##       nox &lt; 0.646    to the right, agree=0.800, adj=0.313, (0 split)
##       tax &lt; 551.5    to the right, agree=0.800, adj=0.313, (0 split)
##       age &lt; 99.2     to the right, agree=0.782, adj=0.250, (0 split)
##       dis &lt; 1.66345  to the left,  agree=0.782, adj=0.250, (0 split)
## 
## Node number 5: 69 observations,    complexity param=0.02238094129
##   mean=22.08695652, MSE=10.9399748 
##   left son=10 (59 obs) right son=11 (10 obs)
##   Primary splits:
##       rm    &lt; 6.531    to the left,  improve=0.3588981640, (0 missing)
##       lstat &lt; 9.65     to the right, improve=0.3568219438, (0 missing)
##       age   &lt; 22.55    to the right, improve=0.2327873348, (0 missing)
##       crim  &lt; 0.56137  to the right, improve=0.1564009962, (0 missing)
##       indus &lt; 3.305    to the right, improve=0.1444801565, (0 missing)
##   Surrogate splits:
##       lstat &lt; 5.25     to the right, agree=0.928, adj=0.5, (0 split)
##       crim  &lt; 0.031145 to the right, agree=0.913, adj=0.4, (0 split)
##       indus &lt; 3.095    to the right, agree=0.913, adj=0.4, (0 split)
## 
## Node number 6: 20 observations
##   mean=31.63, MSE=9.1501 
## 
## Node number 7: 10 observations
##   mean=45.55, MSE=11.2065 
## 
## Node number 8: 16 observations
##   mean=10.41875, MSE=8.284023438 
## 
## Node number 9: 39 observations,    complexity param=0.01804807355
##   mean=17.05384615, MSE=11.31376726 
##   left son=18 (32 obs) right son=19 (7 obs)
##   Primary splits:
##       nox     &lt; 0.531    to the right, improve=0.4951277935, (0 missing)
##       black   &lt; 320.5    to the left,  improve=0.2769208433, (0 missing)
##       crim    &lt; 0.614845 to the right, improve=0.2463272119, (0 missing)
##       ptratio &lt; 19.65    to the right, improve=0.2450038596, (0 missing)
##       dis     &lt; 2.76475  to the left,  improve=0.1965291628, (0 missing)
##   Surrogate splits:
##       indus &lt; 8.005    to the right, agree=0.897, adj=0.429, (0 split)
##       chas  &lt; 0.5      to the left,  agree=0.897, adj=0.429, (0 split)
##       age   &lt; 73.1     to the right, agree=0.897, adj=0.429, (0 split)
##       dis   &lt; 5.31625  to the left,  agree=0.872, adj=0.286, (0 split)
##       tax   &lt; 290.5    to the right, agree=0.872, adj=0.286, (0 split)
## 
## Node number 10: 59 observations
##   mean=21.27118644, MSE=6.770186728 
## 
## Node number 11: 10 observations
##   mean=26.9, MSE=8.45 
## 
## Node number 18: 32 observations
##   mean=15.946875, MSE=5.796865234 
## 
## Node number 19: 7 observations
##   mean=22.11428571, MSE=5.324081633</code></pre>
<pre class="r"><code>pr.rt &lt;- predict(rt.fit,test)
MSE.rt &lt;- sum((pr.rt - test$medv)^2)/nrow(test)</code></pre>
</div>
<div id="foret-aleatoire" class="section level2">
<h2><span class="header-section-number">3.5</span> Forêt aléatoire</h2>
<pre class="r"><code>library(randomForest)</code></pre>
<pre><code>## randomForest 4.6-12</code></pre>
<pre><code>## Type rfNews() to see new features/changes/bug fixes.</code></pre>
<pre><code>## 
## Attaching package: &#39;randomForest&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     margin</code></pre>
<pre class="r"><code>rf.fit &lt;- randomForest(medv~., data=train)
summary(rf.fit)</code></pre>
<pre><code>##                 Length Class  Mode     
## call              3    -none- call     
## type              1    -none- character
## predicted       154    -none- numeric  
## mse             500    -none- numeric  
## rsq             500    -none- numeric  
## oob.times       154    -none- numeric  
## importance       13    -none- numeric  
## importanceSD      0    -none- NULL     
## localImportance   0    -none- NULL     
## proximity         0    -none- NULL     
## ntree             1    -none- numeric  
## mtry              1    -none- numeric  
## forest           11    -none- list     
## coefs             0    -none- NULL     
## y               154    -none- numeric  
## test              0    -none- NULL     
## inbag             0    -none- NULL     
## terms             3    terms  call</code></pre>
<pre class="r"><code>pr.rf &lt;- predict(rf.fit,test)
MSE.rf &lt;- sum((pr.rf - test$medv)^2)/nrow(test)</code></pre>
</div>
<div id="comparaison" class="section level2">
<h2><span class="header-section-number">3.6</span> Comparaison</h2>
<pre class="r"><code>?barplot
barplot(c(MSE.rt,MSE.lm,MSE.nn,MSE.rf),names.arg = c(&quot;abre&quot;,&quot;GLM&quot;,&quot;nn&quot;,&quot;rf&quot;))</code></pre>
<p><img src="3_boston_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<pre class="r"><code>plot(test$medv,pr.nn_,col=&#39;red&#39;,main=&#39;Real vs predicted NN&#39;,pch=18,cex=0.7)
points(test$medv,pr.lm,col=&#39;blue&#39;,pch=18,cex=0.7)
points(test$medv,pr.rt)
points(test$medv,pr.rf,col=&quot;green&quot;,pch=13)

abline(0,1,lwd=2)
legend(&#39;bottomright&#39;,legend=c(&#39;NN&#39;,&#39;LM&#39;),pch=18,col=c(&#39;red&#39;,&#39;blue&#39;))</code></pre>
<p><img src="3_boston_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<pre class="r"><code>plot(test$medv,pr.nn_,col=&#39;red&#39;,main=&#39;Real vs predicted NN&#39;,pch=18,cex=0.7)
abline(0,1,lwd=2)
legend(&#39;bottomright&#39;,legend=&#39;NN&#39;,pch=18,col=&#39;red&#39;, bty=&#39;n&#39;)</code></pre>
<p><img src="3_boston_files/figure-html/unnamed-chunk-17-2.png" width="672" /></p>
<pre class="r"><code>plot(test$medv,pr.lm,col=&#39;blue&#39;,main=&#39;Real vs predicted lm&#39;,pch=18, cex=0.7)
abline(0,1,lwd=2)
legend(&#39;bottomright&#39;,legend=&#39;LM&#39;,pch=18,col=&#39;blue&#39;, bty=&#39;n&#39;, cex=.95)</code></pre>
<p><img src="3_boston_files/figure-html/unnamed-chunk-17-3.png" width="672" /></p>
<pre class="r"><code>plot(test$medv,pr.rt)</code></pre>
<p><img src="3_boston_files/figure-html/unnamed-chunk-17-4.png" width="672" /></p>
</div>
</div>
<div id="validation-croisee" class="section level1">
<h1><span class="header-section-number">4</span> Validation croisée</h1>
<div id="validation-croisee---glm" class="section level2">
<h2><span class="header-section-number">4.1</span> Validation croisée - glm</h2>
<pre class="r"><code>library(boot)</code></pre>
<pre><code>## 
## Attaching package: &#39;boot&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:lattice&#39;:
## 
##     melanoma</code></pre>
<pre class="r"><code>lm.fit &lt;- glm(medv~.,data=data)
cv.glm(data,lm.fit,K=10)$delta[1]</code></pre>
<pre><code>## [1] 23.55415432</code></pre>
</div>
<div id="validation-croisee---nnet" class="section level2">
<h2><span class="header-section-number">4.2</span> Validation croisée - nnet</h2>
<pre class="r"><code>library(plyr)
cv.error=NULL
k=10
pbar &lt;- create_progress_bar(&#39;text&#39;)
pbar$init(k)</code></pre>
<pre><code>## 
  |                                                                       
  |                                                                 |   0%</code></pre>
<pre class="r"><code>for(i in 1:k){
    index &lt;- sample(1:nrow(data),round(0.9*nrow(data)))
    train.cv &lt;- scaled[index,]
    test.cv &lt;- scaled[-index,]
    
    nn &lt;- neuralnet(f,data=train.cv,hidden=c(5,2),linear.output=T)
    
    pr.nn &lt;- compute(nn,test.cv[,1:13])
    pr.nn &lt;- pr.nn$net.result*(max(data$medv)-min(data$medv))+min(data$medv)
    
    test.cv.r &lt;- (test.cv$medv)*(max(data$medv)-min(data$medv))+min(data$medv)
    
    cv.error[i] &lt;- sum((test.cv.r - pr.nn)^2)/nrow(test.cv)
    
    pbar$step()
}</code></pre>
<pre><code>## 
  |                                                                       
  |======                                                           |  10%
  |                                                                       
  |=============                                                    |  20%
  |                                                                       
  |====================                                             |  30%
  |                                                                       
  |==========================                                       |  40%
  |                                                                       
  |================================                                 |  50%
  |                                                                       
  |=======================================                          |  60%
  |                                                                       
  |==============================================                   |  70%
  |                                                                       
  |====================================================             |  80%
  |                                                                       
  |==========================================================       |  90%
  |                                                                       
  |=================================================================| 100%</code></pre>
<pre class="r"><code>mean(cv.error)</code></pre>
<pre><code>## [1] 13.27980084</code></pre>
<pre class="r"><code>cv.error</code></pre>
<pre><code>##  [1] 14.321858703  8.850445671 22.536840473  5.498474175  5.523138198
##  [6]  7.594841216 13.437108628 28.963917279 17.831447628  8.239936472</code></pre>
<pre class="r"><code>boxplot(cv.error,xlab=&#39;MSE CV&#39;,col=&#39;cyan&#39;,
        border=&#39;blue&#39;,names=&#39;CV error (MSE)&#39;,
        main=&#39;CV error (MSE) for NN&#39;,horizontal=TRUE)</code></pre>
<p><img src="3_boston_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
</div>
<div id="validation-croisee---rf" class="section level2">
<h2><span class="header-section-number">4.3</span> Validation croisée - rf</h2>
<pre class="r"><code>result &lt;- rfcv(data, data$medv, cv.fold=3)
with(result, plot(n.var, error.cv, log=&quot;x&quot;, type=&quot;o&quot;, lwd=2))</code></pre>
<p><img src="3_boston_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<pre class="r"><code>result &lt;- replicate(5, rfcv(data, data$medv), simplify=FALSE)
error.cv &lt;- sapply(result, &quot;[[&quot;, &quot;error.cv&quot;)
matplot(result[[1]]$n.var, cbind(rowMeans(error.cv), error.cv), type=&quot;l&quot;,
        lwd=c(2, rep(1, ncol(error.cv))), col=1, lty=1, log=&quot;x&quot;,
        xlab=&quot;Number of variables&quot;, ylab=&quot;CV Error&quot;)</code></pre>
<p><img src="3_boston_files/figure-html/unnamed-chunk-20-2.png" width="672" /></p>
<pre class="r"><code>#### custom

cv.error=NULL
k=50
pbar &lt;- create_progress_bar(&#39;text&#39;)
pbar$init(k)</code></pre>
<pre><code>## 
  |                                                                       
  |                                                                 |   0%</code></pre>
<pre class="r"><code>for(i in 1:k){
    index &lt;- sample(1:nrow(data),round(0.9*nrow(data)))
    train.cv &lt;- data[index,]
    test.cv &lt;- data[-index,]
    fit.rf &lt;- randomForest(medv~., data=train)
    pr.rf &lt;- predict(fit.rf,test)
    cv.error[i] &lt;- sum((pr.rf - test$medv)^2)/nrow(test)
    pbar$step()
}</code></pre>
<pre><code>## 
  |                                                                       
  |=                                                                |   2%
  |                                                                       
  |===                                                              |   4%
  |                                                                       
  |====                                                             |   6%
  |                                                                       
  |=====                                                            |   8%
  |                                                                       
  |======                                                           |  10%
  |                                                                       
  |========                                                         |  12%
  |                                                                       
  |=========                                                        |  14%
  |                                                                       
  |==========                                                       |  16%
  |                                                                       
  |============                                                     |  18%
  |                                                                       
  |=============                                                    |  20%
  |                                                                       
  |==============                                                   |  22%
  |                                                                       
  |================                                                 |  24%
  |                                                                       
  |=================                                                |  26%
  |                                                                       
  |==================                                               |  28%
  |                                                                       
  |====================                                             |  30%
  |                                                                       
  |=====================                                            |  32%
  |                                                                       
  |======================                                           |  34%
  |                                                                       
  |=======================                                          |  36%
  |                                                                       
  |=========================                                        |  38%
  |                                                                       
  |==========================                                       |  40%
  |                                                                       
  |===========================                                      |  42%
  |                                                                       
  |=============================                                    |  44%
  |                                                                       
  |==============================                                   |  46%
  |                                                                       
  |===============================                                  |  48%
  |                                                                       
  |================================                                 |  50%
  |                                                                       
  |==================================                               |  52%
  |                                                                       
  |===================================                              |  54%
  |                                                                       
  |====================================                             |  56%
  |                                                                       
  |======================================                           |  58%
  |                                                                       
  |=======================================                          |  60%
  |                                                                       
  |========================================                         |  62%
  |                                                                       
  |==========================================                       |  64%
  |                                                                       
  |===========================================                      |  66%
  |                                                                       
  |============================================                     |  68%
  |                                                                       
  |==============================================                   |  70%
  |                                                                       
  |===============================================                  |  72%
  |                                                                       
  |================================================                 |  74%
  |                                                                       
  |=================================================                |  76%
  |                                                                       
  |===================================================              |  78%
  |                                                                       
  |====================================================             |  80%
  |                                                                       
  |=====================================================            |  82%
  |                                                                       
  |=======================================================          |  84%
  |                                                                       
  |========================================================         |  86%
  |                                                                       
  |=========================================================        |  88%
  |                                                                       
  |==========================================================       |  90%
  |                                                                       
  |============================================================     |  92%
  |                                                                       
  |=============================================================    |  94%
  |                                                                       
  |==============================================================   |  96%
  |                                                                       
  |================================================================ |  98%
  |                                                                       
  |=================================================================| 100%</code></pre>
<pre class="r"><code>mean(cv.error)</code></pre>
<pre><code>## [1] 24.89064934</code></pre>
<pre class="r"><code>cv.error</code></pre>
<pre><code>##  [1] 25.05999043 24.74195308 24.49332361 24.96212237 24.98710731
##  [6] 25.21886027 24.64948461 24.50716676 25.15018814 24.89896498
## [11] 25.28346117 24.14786596 24.48824672 24.53708553 24.67991953
## [16] 25.08829265 24.48212925 25.49900596 24.92866099 25.10000285
## [21] 24.54536160 24.79375685 25.11240692 25.03543943 25.38335599
## [26] 24.72975383 24.55763386 24.65199180 25.42088194 24.86281376
## [31] 24.18787024 25.39862590 25.27464770 25.01144060 25.27620486
## [36] 24.73786250 24.88080424 24.74719079 24.29096003 24.89098275
## [41] 25.01259240 25.35836248 25.12999997 24.84052493 24.67507024
## [46] 24.79412934 25.04923612 24.91130598 25.15946941 24.90795841</code></pre>
<pre class="r"><code>boxplot(cv.error,xlab=&#39;MSE CV&#39;,col=&#39;cyan&#39;,
        border=&#39;blue&#39;,names=&#39;CV error (MSE)&#39;,
        main=&#39;CV error (MSE) for NN&#39;,horizontal=TRUE)</code></pre>
<p><img src="3_boston_files/figure-html/unnamed-chunk-20-3.png" width="672" /></p>
</div>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'kezhan'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-79158649-2', 'auto');
  ga('send', 'pageview');

</script>
<p>Copyright &copy; 2016 Kezhan SHI</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
